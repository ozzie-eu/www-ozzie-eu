<!DOCTYPE html>
<html lang="en">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=44149&amp;path=livereload" data-no-instant defer></script>

    <title>Recover deleted .net EF Core Migration History Table :: Ozzie.eu</title>

  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Working with Microsoft EF Core you might need to recover the records on the entity framework migration history table. Here&#39;s an easy way to do it." />
<meta name="keywords" content="joao,osorio,ozzie,blog" />

  <meta name="robots" content="noodp" />

<link rel="canonical" href="http://localhost:44149/post/deleted-dotnet-ef-core-migration-history/" />






  <link rel="stylesheet" href="http://localhost:44149/css/buttons.min.86f6b4c106b6c6eb690ae5203d36b442c1f66f718ff4e8164fa86cf6c61ad641.css">


  <link rel="stylesheet" href="http://localhost:44149/css/code.min.d529ea4b2fb8d34328d7d31afc5466d5f7bc2f0bc9abdd98b69385335d7baee4.css">


  <link rel="stylesheet" href="http://localhost:44149/css/fonts.min.5bb7ed13e1d00d8ff39ea84af26737007eb5051b157b86fc24487c94f3dc8bbe.css">


  <link rel="stylesheet" href="http://localhost:44149/css/footer.min.eb8dfc2c6a7eafa36cd3ba92d63e69e849e2200e0002a228d137f236b09ecd75.css">


  <link rel="stylesheet" href="http://localhost:44149/css/gist.min.a751e8b0abe1ba8bc53ced52a38b19d8950fe78ca29454ea8c2595cf26aad5c0.css">


  <link rel="stylesheet" href="http://localhost:44149/css/header.min.75c7eb0e2872d95ff48109c6647d0223a38db52e2561dd87966eb5fc7c6bdac6.css">


  <link rel="stylesheet" href="http://localhost:44149/css/main.min.36833afd348409fc6c3d09d0897c5833d9d5bf1ff31f5e60ea3ee42ce2b1268c.css">


  <link rel="stylesheet" href="http://localhost:44149/css/menu.min.3c17467ebeb3d38663dce68f71f519901124fa5cbb4519b2fb0667a21e9aca39.css">


  <link rel="stylesheet" href="http://localhost:44149/css/pagination.min.bbb986dbce00a5ce5aca0504b7925fc1c581992a4bf57f163e5d69cc1db7d836.css">


  <link rel="stylesheet" href="http://localhost:44149/css/post.min.e6dddd258e64c83e05cec0cd49c05216742d42fc8ecbfbe6b67083412b609bd3.css">


  <link rel="stylesheet" href="http://localhost:44149/css/syntax.min.a0773cce9310cb6d8ed23e50f005448facf29a53001b57e038828daa466b25c0.css">


  <link rel="stylesheet" href="http://localhost:44149/css/terminal.min.e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855.css">


  <link rel="stylesheet" href="http://localhost:44149/css/terms.min.b81791663c3790e738e571cdbf802312390d30e4b1d8dc9d814a5b5454d0ac11.css">







<link rel="shortcut icon" href="http://localhost:44149/favicon.png">
<link rel="apple-touch-icon" href="http://localhost:44149/apple-touch-icon.png">


<meta name="twitter:card" content="summary" />



<meta property="og:locale" content="en" />
<meta property="og:type" content="article" />
<meta property="og:title" content="Recover deleted .net EF Core Migration History Table">
<meta property="og:description" content="Working with Microsoft EF Core you might need to recover the records on the entity framework migration history table. Here&#39;s an easy way to do it." />
<meta property="og:url" content="http://localhost:44149/post/deleted-dotnet-ef-core-migration-history/" />
<meta property="og:site_name" content="Ozzie.eu" />

  <meta property="og:image" content="http://localhost:44149/og-image.png">

<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="627">

  <meta property="article:section" content="backend" />

  <meta property="article:section" content="Database" />


  <meta property="article:published_time" content="2024-05-23 16:02:02 &#43;0100 &#43;0100" />












</head>
<body>


<div class="container center">

  <header class="header">
  <div class="header__inner">
    <div class="header__logo">
      <a href="/">
  <div class="logo">
    Ozzie.eu
  </div>
</a>

    </div>

      <ul class="menu menu--mobile">
  <li class="menu__trigger">Menu&nbsp;▾</li>
  <li>
    <ul class="menu__dropdown">


          <li><a href="/">Home</a></li>



          <li><a href="/post">All Posts</a></li>



          <li><a href="/about">About</a></li>



          <li><a href="/tags">Tags</a></li>



          <li><a href="/categories">Categories</a></li>



    </ul>
  </li>
</ul>



  </div>

    <nav class="navigation-menu">
  <ul class="navigation-menu__inner menu--desktop">



          <li><a href="/" >Home</a></li>



          <li><a href="/post" >All Posts</a></li>



          <li><a href="/about" >About</a></li>



          <li><a href="/tags" >Tags</a></li>



          <li><a href="/categories" >Categories</a></li>




  </ul>
</nav>


</header>


  <div class="content">

<article class="post">
  <h1 class="post-title">
    <a href="http://localhost:44149/post/deleted-dotnet-ef-core-migration-history/">Recover deleted .net EF Core Migration History Table</a>
  </h1>
  <div class="post-meta"><time class="post-date">2024-05-23</time></div>


    <span class="post-tags">

      #<a href="http://localhost:44149/tags/sqlserver/">sqlserver</a>&nbsp;

      #<a href="http://localhost:44149/tags/dotnetcore/">dotnetcore</a>&nbsp;

      #<a href="http://localhost:44149/tags/c#/">C#</a>&nbsp;

    </span>






  <div class="post-content"><div>
        <p>Working with Microsoft EF Core you might need to recover the records on the entity framework migration history table. Here&rsquo;s an easy way to do it, right from Visual Studio&rsquo;s Package Manager Console.</p>
<p>If you&rsquo;re using migrations, for sure you have used <a href="https://www.nuget.org/packages/Microsoft.EntityFrameworkCore.Tools">Microsoft.EntityFrameworkCore.Tools</a>. this tools make available a set of Cmdlets, the one we need for the task in hand is Get-Migration.</p>
<p>First of all, go to the Nuget Package Manager and check which version of the EF package you are using. For the sake of example, I&rsquo;ll use version &lsquo;7.0.5&rsquo;.
Next, open your favorite text editor and copy the following script:</p>
<pre tabindex="0"><code># Get migration IDs
$migrationIds = Get-Migration -noConnect | Select-Object -ExpandProperty Id

# Loop through each migration ID
foreach ($id in $migrationIds) {
  # Generate INSERT statement with placeholder for applied date
  $insertStatement = &#34;INSERT INTO [__EFMigrationsHistory] (MigrationId, ProductVersion) VALUES (&#39;$id&#39;, &#39;7.0.5&#39;)&#34;

  # Write INSERT statement with formatted current date
  Write-Output ($insertStatement)
}
</code></pre><p>Remember to replace &lsquo;7.0.5&rsquo; with your version. Save the script as a <strong>.ps1</strong> file into your project folder. Go to Visual Studio and call the script from the Package Manager Console.The console should output the needed insert statements to restore the migration history records.</p>
<p>Of course, if you really mucked up and dropped the actual table from the database, you have to create it, before running the SQL insert statements. For this you can use this <strong>CREATE</strong> statement on the database:</p>
<pre tabindex="0"><code>CREATE TABLE [dbo].[__EFMigrationsHistory](
	[MigrationId] [nvarchar](150) NOT NULL,
	[ProductVersion] [nvarchar](32) NOT NULL,
 CONSTRAINT [PK___EFMigrationsHistory] PRIMARY KEY CLUSTERED
(
	[MigrationId] ASC
)WITH (PAD_INDEX = OFF, STATISTICS_NORECOMPUTE = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS = ON, ALLOW_PAGE_LOCKS = ON, OPTIMIZE_FOR_SEQUENTIAL_KEY = OFF) ON [PRIMARY]
) ON [PRIMARY]
GO
</code></pre><p>To get the insert statements output to a text file just redirect the output to a file, for instance, if you called your script &lsquo;Repopulate-Migrations.ps1&rsquo;, run:</p>
<pre tabindex="0"><code>Repopulate-Migrations.ps1 &gt; out.txt
</code></pre><p>Hope this helps.</p>

      </div></div>



<div class="pagination">
  <div class="pagination__title">
    <span class="pagination__title-h">Read other posts</span>
    <hr />
  </div>
  <div class="pagination__buttons">

      <a href="http://localhost:44149/post/orm-vs-raw-sql/" class="button inline prev">
        &lt; [<span class="button__text">ORM vs. Raw SQL: A Performance Showdown</span>]
      </a>


      ::


      <a href="http://localhost:44149/post/using-email-as-login-bad-idea/" class="button inline next">
         [<span class="button__text">Using an email as your login is a bad idea</span>] &gt;
      </a>

  </div>
</div>








</article>

  </div>


    <footer class="footer">
  <div class="footer__inner">

      <div class="copyright">
        <span>© 2025 Powered by <a href="https://gohugo.io">Hugo</a></span>

      <span>:: <a href="https://github.com/panr/hugo-theme-terminal" target="_blank">Theme</a> made by <a href="https://github.com/panr" target="_blank">panr</a></span>
      </div>
  </div>
</footer>






<script type="text/javascript" src="/bundle.min.js"></script>






</div>

</body>
</html>
